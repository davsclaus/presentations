<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Fabric8 CDI &amp; Arquillian</title>

		<meta name="description" content="A walkthrough on the integration of Fabric8 with CDI and Arquillian">
		<meta name="author" content="Ioannis Canellos">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=2.0, maximum-scale=2.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
        <!--link rel="stylesheet" href="css/print/pdf.css"-->

		<link rel="stylesheet" href="css/theme/night.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
              <!--iframe src="http://istation:8181" tyle="width: 90%; height="90%" scrolling="no"/-->
					<h1>Fabric8 v2</h1>
					<h3>CDI</h3>
					<h3>Arquillian</h3>
					<p>
						<small>by <a href="http://iocanel.blogspot.com">Ioannis Canellos</a> / <a href="http://twitter.com/iocanel">@iocanel</a></small>
					</br>
						<small>and <a href="http://iocanel.blogspot.com">Claus Ibsen</a> / <a href="http://twitter.com/davsclaus">@davsclaus</a></small>
					</p>
				</section>

				<!-- Example of nested vertical slides -->
				<section>
					<section>
						<h2>Overview</h2>
						<ul>
							<li>Prologue</li>
							<li>CDI Extension</li>
							<li>Arquillian Extension</li>
						</ul>						
					</section>
				</section>
				
				<section>
					<section>
						<h2>Prologue</h2>
					</section>
					<section>
						<h2>Fabric8 v1</h2>
						<ul>
							<li>Framework</li>
							<li>Tooling</li>
						</ul>
					</section>
					<section>
						<h2>Changes in Fabric8 v2</h2>
						<ul>
							<li>Hello Kubernetes</li>
							<li>Bye bye OSGi</li>
						</ul>
					</section>
					<section>
						<h2>Hello Kubernetes</h2>
						<ul>
							<li>Container management</li>
							<li>Service discovery</li>
						</ul>
					</section>
					<section>
						<h2>Bye bye OSGi</h2>
						<ul>
							<li>Platform</li>
							<li>Framework(?)</li>
						</ul>
					</section>
					<section>
						<h2>CDI</h2>
						<p>The common denominator</p>
					</section>
				</section>

				<section>
					<section>
						<h2>CDI Extension</h2>
					</section>
					<section>
						<h2>CDI Extension Features</h2>
						<ul>
							<li>"Hybrid": Inside/Outside of Kubernetes</li>
							<li>Injection of Kubernetes Client</li>
							<li>Kubernetes Services as CDI Beans</li>
							<li>@Service Qualifier</li>
						</ul>
					</section>
                    <section>
						<h2>Hybrid</h2>
						<ul>
							<li>Inside: Understands env variables</li>
							<li>Outside: Uses the kubernetes api wheen needed</li>
						</ul>
					</section>
					<section>
						<h2>Client injection</h2>
						<ul>
							<li>Env configured client</li>
							<li>Added as a "bean"</li>
						</ul>
					</section>
					<section>
						<h2>Service injection</h2>
						<p>For each injection point annotated with @Service</p>
						<br/>
						<ol>
							<li>Lookup env for coords</li>
							<li>Query Kubernetes for Id &amp; Namespace</li>
							<li>Query Kubernetes for Id?</li>
						</ol>
						<br/>
						<br/>
						<br/>
						<br/>

						<p>Annotated types: String or URL</p>
					</section>
					<section>
						<h2>How cool would it be...</h2>
						<p class="fragment roll-in"> To not only inject the service coords...</p>
						<p class="fragment roll-in">...but also the clients?</p>
						<img width="512" height="328" class="fragment fade-in" src="images/shut-up-and-take-my-money.jpg" alt="Shutup and take my money">
					</section>
					<section>
						<h2>@Produces &amp; @Services</h2>
						<p>Methods annotated with both act as a "converter"</p>
						<ul>
							<li>Generic: No need to specify which service</li>
							<li>We tell the framework how and it takes care of the rest</li>
						</ul>
						<br/>
						<br/>
						<pre class="fragment fade-in"><code data-trim contenteditable>
@Produces
@Service
ActiveMQConnectionFactory convert(@Service String url) {
    return new ActiveMQConnectionFactory(url);
}					
						</code></pre>
					</section>
					<section>
						<h2>Next Steps</h2>
						<ul>
							<li>Fabric8 apps should provide default "converters"</li>
							<li>Combine @Service and @PropertyConfig</li>
						</ul>
					</section>
				</section>
				<section>
					<section>
						<h2>Arquillian</h2>
					</section>
					<section>
						<h2>What do we need to test?</h2>
						<ul>
							<li>Code</li>
							<li>Docker Images</li>
							<li>Kubernetes Config</li>			
						</ul>					
					</section>
					<section>
						<h2>Big Bang Testing</h2>
						<p> We need to test everything as whole</p>
						<img width="512" height="328" src="images/big-bang.jpg" alt="Big Bang">
					</section>
					<section>
						<h2>Arquillian Cube?</h2>
					    <ul>
							<li>In container</li>
							<li>In app server</li>
							<li>Despite the name doesn't work with Kubernetes</li>			
						</ul>
					</section>
                    <section>
						<h2>Fabric8 Arquillian Extension</h2>
					    <ul>
					    	<li>Convention over configuration</li>
							<li>Kubernetes Support</li>
							<li>Dependency Management</li>
							<li>Kubernetes constructs as Arquillian Resources</li>
							<li>Assertion DSL for Kubernetes constructs</p>			
						</ul>
					</section>
					<section>
						<h2>Standard Conventions</h2>
					    <ul>
					    	<li>Where Kubernetes Master lives</li>
							<li>Discovery of kubernetes json</li>
							<li>Discovery of "dependencies"</li>	
						</ul>
					</section>
					<section>
						<h2>Dependency Discovery</h2>
					    <ul>
							<li>Using the classpath</li>
							<li>Using the pom.xml</li>
							<li>Explicitly specified as a URL (works with mvn URLs too)</li>	
						</ul>
												<pre class="fragment fade-in"><code data-trim contenteditable>
<extension qualifier="kubernetes">
    <property name="dependencies">mvn:${project.groupId}/fabric8-mq/${project.version}/json/kubernetes</property>
</extension>					
						</code></pre>
					</section>
					<section>
						<h2>Arquillian Resources</h2>
					    <ul>
					    	<li>Session</li>
					    	<li>Pods</li>
							<li>Replication Controllers</li>
							<li>Services</li>		
						</ul>
					</section>
					<section>
						<h2>What is a Session?</h2>
					    <ul>
					    	<li>The interaction of the extension with Kubernetes</li>
					    	<li>Shares lifecycle with the test Suite</li>
							<li>Has a unique Kubernetes Namespace</li>
							<li>What happens in session stays in session</li>		
						</ul>
					</section>
					<section>
						<h2>Arquillian Resources Example</h2>
						<pre><code data-trim contenteditable>

@RunWith(Arquillian.class)
public class SuperCoolTest {

    @ArquillianResource
    KubernetesClient client;

    @ArquillianResource
    static Session session;

    @Test
    public void superTest() {
       //Do stuff
    }
}
				
						</code></pre>
					</section>
					<section>
						<h2>Assertion Examples</h2>
						<pre><code data-trim contenteditable>
@Test
public void superTest() {
	assertThat(client)
	.replicationController("super-controller", session.getNamespace())
	.isNotNull();

	assertThat(client).pods()
                .runningStatus()
                .filterNamespace(session.getNamespace())
                .haveAtLeast(3, (Condition)(podSchema) ->{return true});
}
					
						</code></pre>
						 
					</section>
				</section>
				<section>
					<h2>Questions?</h2>
				</section>
				<section>
					<h2>THE END</h2>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: false,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
